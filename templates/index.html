<!-- templates/index.html -->
{% extends 'base.html' %}
{% block content %}
<div class="row">
  <div class="col-md-4">
    <h4>Add Expense</h4>
    <form method="POST" action="{{ url_for('add') }}">
      <div class="mb-2">
        <label class="form-label">Amount</label>
        <input name="amount" type="number" step="0.01" class="form-control" required>
      </div>
      <div class="mb-2">
        <label class="form-label">Category</label>
        <input name="category" list="cats" class="form-control" placeholder="e.g., Food, Rent">
        <datalist id="cats">
          {% for c in categories %}
            <option value="{{ c }}">
          {% endfor %}
        </datalist>
      </div>
      <div class="mb-2">
        <label class="form-label">Date</label>
        <input name="date" type="date" class="form-control">
      </div>
      <div class="mb-2">
        <label class="form-label">Payment method</label>
        <input name="payment_method" class="form-control" placeholder="Cash / Card / UPI">
      </div>
      <div class="mb-2">
        <label class="form-label">Description</label>
        <input name="description" class="form-control">
      </div>
      <button class="btn btn-success">Add</button>
    </form>
    <hr>
    <a class="btn btn-outline-secondary" href="{{ url_for('export_csv') }}">Download CSV</a>
    <a class="btn btn-outline-primary" href="{{ url_for('api_summary')|replace('/api/summary','/stats') }}">View Stats</a>
  </div>

  <div class="col-md-8">
    <h4>Expenses (Total: ₹ {{ '%.2f' % total }})</h4>
    <form class="row g-2 mb-3" method="get" action="{{ url_for('index') }}">
      <div class="col-auto"><input type="date" name="start" class="form-control" value="{{ request.args.get('start','') }}"></div>
      <div class="col-auto"><input type="date" name="end" class="form-control" value="{{ request.args.get('end','') }}"></div>
      <div class="col-auto">
        <select name="category" class="form-select">
          <option value="">All categories</option>
          {% for c in categories %}<option value="{{ c }}" {% if request.args.get('category')==c %}selected{% endif %}>{{ c }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-auto"><button class="btn btn-sm btn-primary">Filter</button></div>
    </form>

    <table class="table table-striped">
      <thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th><th>Method</th><th>Actions</th></tr></thead>
      <tbody>
        {% for e in expenses %}
        <tr>
          <td>{{ e.date.strftime('%Y-%m-%d') }}</td>
          <td>{{ e.category }}</td>
          <td>{{ e.description or '' }}</td>
          <td>₹ {{ '%.2f' % e.amount }}</td>
          <td>{{ e.payment_method or '' }}</td>
          <td>
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('edit', expense_id=e.id) }}">Edit</a>
            <form style="display:inline" method="post" action="{{ url_for('delete', expense_id=e.id) }}" onsubmit="return confirm('Delete this expense?');">
              <button class="btn btn-sm btn-danger">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6">No expenses yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
